# #### 6.2 å…¨è¿æ¥å±‚
import tensorflow as tf
from keras import layers


if __name__ == "__main__":

    # 6.2.1 å¼ é‡æ–¹å¼å®ç°

    # åœ¨ TensorFlow ä¸­ï¼Œè¦å®ç°å…¨è¿æ¥å±‚ï¼Œåªéœ€è¦å®šä¹‰å¥½æƒå€¼å¼ é‡ğ‘¾å’Œåç½®å¼ é‡ğ’ƒï¼Œ
    # å¹¶åˆ©ç”¨TensorFlow æä¾›çš„æ‰¹é‡çŸ©é˜µç›¸ä¹˜å‡½æ•° tf.matmul()å³å¯å®Œæˆç½‘ç»œå±‚çš„è®¡ç®—ã€‚

    # ä¾‹å¦‚ï¼Œåˆ›å»ºè¾“å…¥ğ‘¿ çŸ©é˜µä¸ºğ‘ = 2ä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬çš„è¾“å…¥ç‰¹å¾é•¿åº¦ä¸ºğ‘‘in = 784ï¼Œ
    # x = tf.random.normal(shape=[2, 784])
    # print(x.shape)

    # è¾“å‡ºèŠ‚ç‚¹æ•°ä¸ºğ‘‘out = 256ï¼Œæ•…å®šä¹‰æƒå€¼çŸ©é˜µğ‘¾çš„ shape ä¸º[784,256]ï¼Œ
    # å¹¶é‡‡ç”¨æ­£æ€åˆ†å¸ƒåˆå§‹åŒ–ğ‘¾ï¼›åç½®å‘é‡ğ’ƒçš„ shape å®šä¹‰ä¸º[256]ï¼Œ
    # w = tf.random.normal(shape=[784, 256])
    # b = tf.random.normal(shape=[256])

    # åœ¨è®¡ç®—å®Œğ‘¿@ğ‘¾åç›¸åŠ å³å¯ï¼Œæœ€ç»ˆå…¨è¿æ¥å±‚çš„è¾“å‡ºğ‘¶çš„ shape ä¸º[2,256]ï¼Œ
    # å³ 2 ä¸ªæ ·æœ¬çš„ç‰¹å¾ï¼Œæ¯ä¸ªç‰¹å¾é•¿åº¦ä¸º 256
    # o = x@w+b
    # print(o.shape)

    # 6.2.2 å±‚æ–¹å¼å®ç°

    # TensorFlow ä¸­æœ‰æ›´é«˜å±‚ã€ä½¿ç”¨æ›´æ–¹ä¾¿çš„å±‚å®ç°æ–¹å¼ï¼š
    # layers.Dense(units, activation)ã€‚
    # é€šè¿‡ layer.Dense ç±»ï¼Œåªéœ€è¦æŒ‡å®šè¾“å‡ºèŠ‚ç‚¹æ•° Units å’Œæ¿€æ´»å‡½æ•°ç±»å‹ activation å³å¯ã€‚

    # å¯¼å…¥å±‚æ¨¡å— 28*28=784
    x = tf.random.normal([4, 28 * 28])
    # åˆ›å»ºå…¨è¿æ¥å±‚ï¼ŒæŒ‡å®šè¾“å‡ºèŠ‚ç‚¹æ•°å’Œæ¿€æ´»å‡½æ•°
    fc = layers.Dense(512, activation=tf.nn.relu)
    # <keras.layers.core.dense.Dense object at 0x000002A368E14FA0>
    print(fc)
    # é€šè¿‡ fc ç±»å®ä¾‹å®Œæˆä¸€æ¬¡å…¨è¿æ¥å±‚çš„è®¡ç®—ï¼Œè¿”å›è¾“å‡ºå¼ é‡
    h1 = fc(x)
    # h1 = tf.Tensor shape=(4, 512)
    print(h1)

    # è¾“å…¥çš„èŠ‚ç‚¹æ•°åœ¨fc(x)è®¡ç®—æ—¶è‡ªåŠ¨è·å–ï¼Œå¹¶åˆ›å»ºå†…éƒ¨æƒå€¼å¼ é‡ğ‘¾å’Œåç½®å¼ é‡ğ’ƒ
    # - å¯ä»¥é€šè¿‡ç±»å†…éƒ¨çš„æˆå‘˜å kernel å’Œ bias æ¥è·å–æƒå€¼å¼ é‡ ğ‘¾ å’Œåç½®å¼ é‡ ğ’ƒ å¯¹è±¡
    # fc.kernel = tf.Variable shape=(784, 512)
    print(fc.kernel)
    # fc.bias = tf.Variable shape=(512,)
    print(fc.bias)
    # - åœ¨ä¼˜åŒ–å‚æ•°æ—¶ï¼Œéœ€è¦è·å¾—ç½‘ç»œçš„æ‰€æœ‰å¾…ä¼˜åŒ–çš„å¼ é‡å‚æ•°åˆ—è¡¨ï¼Œ
    # å¯ä»¥é€šè¿‡ç±»çš„ trainable_variables æ¥è¿”å›å¾…ä¼˜åŒ–å‚æ•°åˆ—è¡¨
    # fc.trainable_variables = tf.Variable 'dense/kernel:0' å’Œ tf.Variable 'dense/bias:0'
    print("@fc.trainable_variables=", fc.trainable_variables)
    # - è¿˜æœ‰éƒ¨åˆ†å±‚åŒ…å«äº†ä¸å‚ä¸æ¢¯åº¦ä¼˜åŒ–çš„å¼ é‡ï¼Œå¦‚åç»­ä»‹ç»çš„ Batch Normalization å±‚ï¼Œ
    # å¯ä»¥é€šè¿‡non_trainable_variables æˆå‘˜è¿”å›æ‰€æœ‰ä¸éœ€è¦ä¼˜åŒ–çš„å‚æ•°åˆ—è¡¨ã€‚
    # å¦‚æœå¸Œæœ›è·å¾—æ‰€æœ‰å‚æ•°åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡ç±»çš„ variables è¿”å›æ‰€æœ‰å†…éƒ¨å¼ é‡åˆ—è¡¨

    print("@fc.variables=", fc.variables)

    # - å¯¹äºå…¨è¿æ¥å±‚ï¼Œå†…éƒ¨å¼ é‡éƒ½å‚ä¸æ¢¯åº¦ä¼˜åŒ–ï¼Œæ•… variables è¿”å›çš„åˆ—è¡¨ä¸ trainable_variables ç›¸åŒã€‚
    # - åˆ©ç”¨ç½‘ç»œå±‚ç±»å¯¹è±¡è¿›è¡Œå‰å‘è®¡ç®—æ—¶ï¼Œåªéœ€è¦è°ƒç”¨ç±»çš„**call**æ–¹æ³•å³å¯ï¼Œ
    #     å³å†™æˆ fc(x)æ–¹å¼ä¾¿å¯ï¼Œå®ƒä¼šè‡ªåŠ¨è°ƒç”¨ç±»çš„**call**æ–¹æ³•ï¼Œåœ¨**call**æ–¹æ³•ä¸­ä¼šè‡ªåŠ¨è°ƒç”¨ call æ–¹æ³•

    pass
